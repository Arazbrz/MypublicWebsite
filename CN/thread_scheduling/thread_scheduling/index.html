<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="My Portofolio">
    <meta name="author" content="Araz B Karimi">
    
    <link rel="shortcut icon" href="../../../img/favicon.ico">

    
    <title>Thread Scheduling Lab - Araz Karimi | Personal Website</title>
    

    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/v4-shims.css">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hack-font@3.3.0/build/web/hack.min.css">
    <link href='//rsms.me/inter/inter.css' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,700italic,400,300,600,700&subset=latin-ext,latin' rel='stylesheet' type='text/css'>
    <link href="../../../css/bootstrap-custom.min.css" rel="stylesheet">
    <link href="../../../css/base.min.css" rel="stylesheet">
    <link href="../../../css/cinder.min.css" rel="stylesheet">

    
        
        <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.18.0/build/styles/github.min.css">
        
    

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
            <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
            <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
        <![endif]-->

    

     
</head>

<body>

    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->

            <a class="navbar-brand" href="../../..">Araz Karimi | Personal Website</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="../../..">Home</a>
                    </li>
                
                
                
                    <li >
                        <a href="../../../ECE/overview.md">Electrical Engineering</a>
                    </li>
                
                
                
                    <li >
                        <a href="../../../DS/overview.md">Example Projects</a>
                    </li>
                
                
                
                    <li >
                        <a href="../../overview.md">Contact</a>
                    </li>
                
                
                </ul>

            <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                            <i class="fas fa-search"></i> Search
                        </a>
                    </li>
            </ul>
        </div>
    </div>
</div>

    <div class="container">
        
        
        <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="first-level active"><a href="#introduction">Introduction</a></li>
            <li class="second-level"><a href="#scheduling-algorithms">Scheduling Algorithms</a></li>
                
            <li class="second-level"><a href="#process-states">Process States</a></li>
                
            <li class="second-level"><a href="#the-ready-queue">The Ready Queue</a></li>
                
            <li class="second-level"><a href="#scheduling-processes">Scheduling Processes</a></li>
                
            <li class="second-level"><a href="#cpu-scheduler-invocation">CPU Scheduler Invocation</a></li>
                
            <li class="second-level"><a href="#the-simulator">The Simulator</a></li>
                
            <li class="second-level"><a href="#problem-1-fifo-scheduler">Problem 1: FIFO Scheduler</a></li>
                
            <li class="second-level"><a href="#hints">Hints</a></li>
                
            <li class="second-level"><a href="#problem-2-round-robin-scheduler-extra-credit">Problem 2: Round-Robin Scheduler (Extra Credit)</a></li>
                
            <li class="second-level"><a href="#problem-3-longest-remaining-time-first-scheduler-extra-credit">Problem 3: Longest Remaining Time First Scheduler (Extra Credit)</a></li>
                
            <li class="second-level"><a href="#deliverables">Deliverables</a></li>
                
    </ul>
</div></div>
        <div class="col-md-9" role="main">


<H1>Thread Scheduling Lab</H1>



<p><b>Author:</b> Tushar Krishna</p>



<a href="../pdfs/thread_scheduling.pdf"><strong>PDF Version</strong></a>


<h1 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">&para;</a></h1>
<p>In this lab, you will implement a multiprocessor operating system simulator using a popular userspace threading library for linux called <strong>pthreads</strong>. The framework for the multithreaded OS simulator is nearly complete, but missing one critical component: the CPU scheduler! Your task is to implement the CPU scheduler, using three different scheduling algorithms.</p>
<p><strong>Note: Make sure that multiple CPU cores are enabled in your virtual machine, otherwise you will receive incorrect results. See the TAs if you need help.</strong></p>
<p>This can be done in virtualbox by going to: Settings &gt; System &gt; Processor &gt; CPUs</p>
<p>We have provided you with source files that constitute the framework for your simulator. You will only need to modify <code>answers.txt</code> and <code>student.c</code>. However, just because you are only modifying two files doesn't mean that you should ignore the other ones - there is helpful information in the other files.
We have provided you these files:  <a href="../assignment.zip">assignment.zip</a></p>
<h2 id="scheduling-algorithms">Scheduling Algorithms<a class="headerlink" href="#scheduling-algorithms" title="Permanent link">&para;</a></h2>
<p>For your simulator, you will implement the following three CPU scheduling algorithms: </p>
<ul>
<li><code>First In, First Out (FIFO)</code> - Runnable processes are kept in a ready queue. FIFO is non-preemptive; once a process begins running on a CPU, it will continue running until it either completes or blocks for I/O. </li>
<li><code>Round-Robin (Extra Credit)</code> - Similar to FIFO, except preemptive. Each process is assigned a timeslice when it is scheduled. At the end of the timeslice, if the process is still running, the process is preempted, and moved to the tail of the ready queue.</li>
<li><code>Longest Remaining Time First (LRTF) (Extra Credit)</code> - The process with the longest remaining time in its burst always gets the CPU.  Shorter processes must be pre-empted if a process that has a longer burst becomes runnable.</li>
</ul>
<h2 id="process-states">Process States<a class="headerlink" href="#process-states" title="Permanent link">&para;</a></h2>
<p>In our OS simulation, there are five possible states for a process, which are listed in the process_state_t enum in os-sim.h:</p>
<ol>
<li><code>NEW</code> - The process is being created, and has not yet begun executing.</li>
<li><code>READY</code> - The process is ready to execute, and is waiting to be scheduled on a CPU.</li>
<li><code>RUNNING</code> - The process is currently executing on a CPU.</li>
<li><code>WAITING</code> - The process has temporarily stopped executing, and is waiting on an I/O request to complete.</li>
<li><code>TERMINATED</code> - The process has completed.</li>
</ol>
<p>There is a field named state in the PCB, which must be updated with the current state of the process. The simulator will use this field to collect statistics.</p>
<h2 id="the-ready-queue">The Ready Queue<a class="headerlink" href="#the-ready-queue" title="Permanent link">&para;</a></h2>
<p>On most systems, there are a large number of processes, but only one or two CPUs on which to execute them. When there are more processes ready to execute than CPUs, processes must wait in the READY state until a CPU becomes available. To keep track of the processes waiting to execute, we keep a ready queue of the processes in the READY state</p>
<p>Since the ready queue is accessed by multiple processors, which may add and remove processes from the ready queue, the ready queue must be protected by some form of synchronization--for this lab assignment, you will use a mutex lock. <strong>The ready queue SHOULD use a different mutex than the current mutex.</strong></p>
<h2 id="scheduling-processes">Scheduling Processes<a class="headerlink" href="#scheduling-processes" title="Permanent link">&para;</a></h2>
<p><code>schedule()</code> is the core function of the CPU scheduler. It is invoked whenever a CPU becomes available for running a process. <code>schedule()</code> must search the ready queue, select a runnable process, and call the <code>context\_switch()</code> function to switch the process onto the CPU.</p>
<p>There is a special process, the idle process, which is scheduled whenever there are no processes in the READY state.</p>
<h2 id="cpu-scheduler-invocation">CPU Scheduler Invocation<a class="headerlink" href="#cpu-scheduler-invocation" title="Permanent link">&para;</a></h2>
<p>There are four events which will cause the simulator to invoke schedule():</p>
<ol>
<li>yield() - A process completes its CPU operations and yields the processor to perform an I/O request.</li>
<li>wake_up() - A process that previously yielded completes its I/O request, and is ready to perform CPU operations. wake_up() is also called when a process in the NEW state becomes runnable.</li>
<li>preempt() - When using a LRTF or Round-Robin scheduling algorithm, a CPU-bound process may be preempted before it completes its CPU operations.</li>
<li>terminate() - A process exits or is killed.</li>
</ol>
<p>The CPU scheduler also contains one other important function: <code>idle()</code>. <code>idle()</code> contains the code that gets by the idle process. In the real world, the idle process puts the processor in a low-power mode and waits. For our OS simulation, you will use a pthread condition variable to block the thread until a process enters the ready queue.</p>
<h2 id="the-simulator">The Simulator<a class="headerlink" href="#the-simulator" title="Permanent link">&para;</a></h2>
<p>We will use pthreads to simulate an operating system on a multiprocessor computer. We will use one thread per CPU and one thread as a 'supervisor' for our simulation. The CPU threads will simulate the currently-running processes on each CPU, and the supervisor thread will print output and dispatch events to the CPU threads.</p>
<p>Since the code you write will be called from multiple threads, the CPU scheduler you write must be thread-safe! This means that all data structures you use, including your ready queue, must be protected using mutexes.</p>
<p>The number of CPUs is specified as a command-line parameter to the simulator. For this project, you will be performing experiments with 1, 2, and 4 CPU simulations.</p>
<p>Also, for demonstration purposes, the simulator executes much slower than a real system would. In the real world, a CPU burst might range from one to a few hundred milliseconds, whereas in this simulator, they range from 0.2 to 2.0 seconds.</p>
<p>Compile and run the simulator with <code>./os-sim 2</code>. After a few seconds, hit Control-C to exit. You will see the output below: </p>
<p>The simulator generates a Gantt Chart, showing the current state of the OS at every 100ms interval. The leftmost column shows the current time, in seconds. The next three columns show the number of Running, Ready, and Waiting processes, respectively. The next two columns show the process currently running on each CPU. The rightmost column shows the processes which are currently in the I/O queue, with the head of the queue on the left and the tail of the queue on the right.</p>
<p>As you can see, nothing is executing. This is because we have no CPU scheduler to select processes to execute! Once you complete Problem 1 and implement a basic FIFO scheduler, you will see the processes executing on the CPUs.</p>
<h2 id="problem-1-fifo-scheduler">Problem 1: FIFO Scheduler<a class="headerlink" href="#problem-1-fifo-scheduler" title="Permanent link">&para;</a></h2>
<p><strong>NOTE: Part B of each part requires you to put your answer down in answers.txt</strong></p>
<p><strong>A. [50 points]</strong> - Implement the CPU scheduler using the FIFO scheduling algorithm. You may do this however you like, however, we suggest the following:</p>
<ul>
<li>Implement a thread-safe ready queue using a linked list. A linked list will allow you to reuse this ready queue for the Round-Robin and SRTF scheduling algorithms.</li>
<li>Implement the yield(), wake_up(), and terminate() handlers. preempt() is not necessary for this stage of the project. See the overview and the comments in the code for the proper behavior of these events.</li>
<li>Implement idle(). idle() must wait on a condition variable that is signaled whenever a process is added to the ready queue.</li>
<li>Implement schedule(). schedule() should extract the first process in the ready queue, then call context_switch() to select the process to execute. If there are no runnable processes, schedule() should call context_switch() with a NULL pointer as the PCB to execute the idle process.</li>
</ul>
<h2 id="hints">Hints<a class="headerlink" href="#hints" title="Permanent link">&para;</a></h2>
<ul>
<li>Be sure to update the state field of the PCB. The library will read this field to generate the Running, Ready, and Waiting columns, and to generate the statistics at the end of the simulation.</li>
<li>There is a field in the PCB, next, which you may use to build linked lists of PCBs.</li>
<li>Four of the five entry points into the scheduler (idle(), yield(), terminate(), and preempt()) should cause a new process to be scheduled on the CPU. In your handlers, be sure to call schedule(), which will select a runnable process, and then call context_switch(). When these four functions return, the library will simulate the process selected by context_switch().</li>
<li>context_switch() takes a timeslice parameter, which is used for preemptive scheduling algorithms. Since FIFO is non-preemptive, use -1 for this parameter to give the process an infinite timeslice.</li>
</ul>
<p><strong>B. [5 points]</strong> Run your OS simulation with 1, 2, and 4 CPUs. Compare the total execution time of each. Is there a linear relationship between the number of CPUs and total execution time? Why or why not?  Keep in mind that the execution time refers to the simulated execution time.</p>
<h2 id="problem-2-round-robin-scheduler-extra-credit">Problem 2: Round-Robin Scheduler (Extra Credit)<a class="headerlink" href="#problem-2-round-robin-scheduler-extra-credit" title="Permanent link">&para;</a></h2>
<p><strong>A. [20 points]</strong> Add Round-Robin scheduling functionality to your code. You should modify main() to add a command line option, -r, which selects the Round-Robin scheduling algorithm, and accepts a parameter, the length of the timeslice. For this project, timeslices are measured in tenths of seconds. E.g.:</p>
<p>./os-sim &lt;# CPUs&gt; -r 5</p>
<p>should run a Round-Robin scheduler with timeslices of 500 ms. While:</p>
<p>./os-sim &lt;# of CPUs&gt; </p>
<p>should continue to run a FIFO scheduler.</p>
<p>To specify a timeslice when scheduling a process, use the timeslice parameter of context_switch(). The simulator will automatically preempt the process and call your preempt() handler if the process executes on the CPU for the length of the timeslice without terminating or yielding for I/O.</p>
<p>Note: You need to implement force_preempt() for this scheduler.  The force_preempt() function preempts a running process before its timeslice expires.</p>
<p><strong>B. [5 points]</strong> Run your Round-Robin scheduler with timeslices of 800ms, 600ms, 400ms, and 200ms. Use only one CPU for your tests. Compare the statistics at the end of the simulation. Show that the total waiting time decreases with shorter timeslices. However, in a real OS, the shortest timeslice possible is usually not the best choice. Why not?</p>
<h2 id="problem-3-longest-remaining-time-first-scheduler-extra-credit">Problem 3: Longest Remaining Time First Scheduler (Extra Credit)<a class="headerlink" href="#problem-3-longest-remaining-time-first-scheduler-extra-credit" title="Permanent link">&para;</a></h2>
<p><strong>A. [20 points]</strong> Add LRTF scheduling to your code. 
You should modify main() to add a command line option, -l, which selects the LRTF scheduling algorithm.</p>
<p>E.g.:</p>
<p>./os-sim &lt;# CPUs&gt; -l</p>
<p>should run a LRTF scheduler. While:</p>
<p>./os-sim &lt;# of CPUs&gt;</p>
<p>should continue to run a FIFO scheduler.</p>
<p><strong>Make sure the default FIFO and Round Robin schedulers should continue to work!</strong></p>
<p>The scheduler should use the time_remaining field of the PCB to prioritize processes that have the longer remaining time in their CPU burst.</p>
<p>For LRTF scheduling, you will need to make use of the current[] array and force_preempt() function.  The current[] array should be used to keep track of the process currently executing on each CPU. Since this array is accessed by multiple CPU threads, it must be protected by a mutex. current_mutex has been provided for you.</p>
<p>Note: You need to implement force_preempt() for this scheduler.  The force_preempt() function preempts a running process before its timeslice expires. Your wake_up() handler should make use of this function to preempt a process when a process with higher time remaining needs a CPU.</p>
<p><strong>B. [10 points]</strong>
- (B.1) While it is easy to simulate an LRTF algorithm in the simulator, it is essentially impossible to implement precisely in real life and is thus usually approximated.  Why is this the case?
- (B.2) Run both scheduling algorithms using one CPU and compare the total waiting times.  Which one has the lowest?  Can you think of a reason why?</p>
<h2 id="deliverables">Deliverables<a class="headerlink" href="#deliverables" title="Permanent link">&para;</a></h2>
<p><strong>NOTE:</strong> Each Problem has two parts (labeled A and B). The first is the actual implementation, and the second is a question linked to the scheduling algorithm you are implementing. Make sure you complete both. </p>
<p><strong>Note/Hint regarding Extra Credit vs. Other Parts.</strong> The total lab is worth 55 points. Parts B and C are for extra credit. Part A (55 points) is compulsory, and necessary for Part B (25 points) and Part C (30 points) to even work. You will still need to implement the force_prempt() function for either of Part B or C to work. Parts B and C are independent - if your final solution works for Parts A and C, not Part B (for instance), you will get 55+30 = 85 points.</p>
<p>Type <code>`make submit'</code> to generate a tarball containing all the files needed for submission.  Please turn in </p>
<ul>
<li><code>&lt;GT_USERNAME&gt;-ece3058-lab-ts.tar.gz</code></li>
</ul>
<p>This tarball should contain:</p>
<ul>
<li>answers.txt - Short answers to questions from above.</li>
<li>Makefile - Working one provided for you; don't break it.</li>
<li>src/os-sim.c - Code for the operating system simulator.</li>
<li>src/os-sim.h - Header file for the simulator.</li>
<li>src/process.c - Descriptions of the simulated processes.</li>
<li>src/process.h - Header file for the process data.</li>
<li>src/student.c - Your code for the scheduler.</li>
<li>src/student.h - Header file for your scheduler code.</li>
</ul>
<p>Keep your answers detailed enough to cover the question, including support from simulator results if appropriate. Don't write a book; but if you're not sure about an answer, err on the side of giving us too much information. </p></div>
        
        
    </div>

    <footer class="col-md-12 text-center">
        
        <hr>
        <p>
        <small>Built with <a href="http://www.mkdocs.org/">MkDocs</a>.</small>
        <small>Developed by <a href="mailto:yimmanuel3@gatech.edu">Yehowshua Immanuel</a>. Maintained by <a href="mailto:tushar@ece.gatech.edu">Tushar Krishna</a></small>
        </p>

        
        
    </footer>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="../../../js/bootstrap-3.0.3.min.js"></script>
    
    <script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.18.0/build/highlight.min.js"></script>
    <script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.18.0/build/languages/bash.min.js"></script>
    <script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.18.0/build/languages/python.min.js"></script>
    <script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.18.0/build/languages/verilog.min.js"></script>
    <script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.18.0/build/languages/c.min.js"></script>
    <script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.18.0/build/languages/c++.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    
    <script>var base_url = "../../.."</script>
    
    <script src="../../../js/base.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
    <script src="../../../search/main.js"></script>

    <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">
                    <span aria-hidden="true">&times;</span>
                    <span class="sr-only">Close</span>
                </button>
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form>
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>
    </body>

</html>
